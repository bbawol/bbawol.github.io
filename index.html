<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024 A2 STEAM Winter Arts Market</title>
    <style>
        body {
            background-color: #f0f8ff;
            font-family: Arial, sans-serif;
            color: #333;
            padding: 20px;
        }

        #fundraiserForm {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background-color: #007bff;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 0;
        }

        button:hover {
            background-color: #0056b3;
        }

        label {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>2024 A2 STEAM Winter Arts Market</h1>
    <form id="fundraiserForm">
        <label for="customerId">Customer ID:</label>
        <input type="text" id="customerId" name="customerId" required><br><br>

        <div id="vendorsContainer">
            <div class="vendorSection">
                <label for="vendorId">Vendor ID:</label>
                <select class="vendorId" name="vendorId[]" required>
                    <option value="1">Vendor 1</option>
                    <option value="2">Vendor 2</option>
                    <!-- Add more vendors as needed -->
                </select><br><br>

                <div class="productsContainer">
                    <div class="productRow">
                        <label>Product:</label>
                        <input type="text" class="productName" name="productName[]" required>
                        <label>Price:</label>
                        <input type="number" class="productPrice" name="productPrice[]" step="0.01" required>
                        <label>Quantity:</label>
                        <input type="number" class="productQuantity" name="productQuantity[]" min="1" required>
                        <button type="button" onclick="deleteProductRow(this)" style="display: none;">Delete
                            Product</button>
                    </div>
                </div>
                <button type="button" onclick="addProductRow(this)">Add Another Product</button><br><br>
                <button type="button" onclick="deleteVendorSection(this)" style="display: none;">Delete
                    Vendor</button><br><br>
            </div>
        </div>
        <button type="button" onclick="addVendorSection()">Add Another Vendor</button><br><br>

        <label>Total: $<span id="totalAmount">0.00</span></label><br><br>
        <button type="submit">Submit</button>
    </form>

    <script>
        function addVendorSection() {
            const vendorsContainer = document.getElementById('vendorsContainer');
            const vendorSection = document.createElement('div');
            vendorSection.classList.add('vendorSection');
            vendorSection.innerHTML = `
        <label for="vendorId">Vendor ID:</label>
        <select class="vendorId" name="vendorId[]" required>
          <option value="1">Vendor 1</option>
          <option value="2">Vendor 2</option>
          <!-- Add more vendors as needed -->
        </select><br><br>

        <div class="productsContainer">
          <div class="productRow">
            <label>Product:</label>
            <input type="text" class="productName" name="productName[]" required>
            <label>Price:</label>
            <input type="number" class="productPrice" name="productPrice[]" step="0.01" required>
            <label>Quantity:</label>
            <input type="number" class="productQuantity" name="productQuantity[]" min="1" required>
            <button type="button" onclick="deleteProductRow(this)" style="display: none;">Delete Product</button>
          </div>
        </div>
        <button type="button" onclick="addProductRow(this)">Add Another Product</button><br><br>
        <button type="button" onclick="deleteVendorSection(this)" style="display: none;">Delete Vendor</button><br><br>
      `;
            vendorsContainer.appendChild(vendorSection);
            vendorSection.querySelector('.productName').focus();
        }

        function addProductRow(button) {
            const productsContainer = button.previousElementSibling;
            const productRow = document.createElement('div');
            productRow.classList.add('productRow');
            productRow.innerHTML = `
        <label>Product:</label>
        <input type="text" class="productName" name="productName[]" required>
        <label>Price:</label>
        <input type="number" class="productPrice" name="productPrice[]" step="0.01" required>
        <label>Quantity:</label>
        <input type="number" class="productQuantity" name="productQuantity[]" min="1" required>
        <button type="button" onclick="deleteProductRow(this)" style="display: none;">Delete Product</button>`;
            productsContainer.appendChild(productRow);
            productRow.querySelector('.productName').focus();
            productRow.querySelector('button').style.display = 'inline-block';
        }

        function deleteProductRow(button) {
            const productRow = button.parentElement;
            productRow.parentElement.removeChild(productRow);
            updateTotal();
            toggleDeleteButtons();
        }

        function deleteVendorSection(button) {
            const vendorSection = button.parentElement;
            vendorSection.parentElement.removeChild(vendorSection);
            updateTotal();
            toggleVendorDeleteButtons();
        }

        document.getElementById('fundraiserForm').addEventListener('input', updateTotal);
        document.getElementById('fundraiserForm').addEventListener('input', toggleDeleteButtons);
        document.getElementById('fundraiserForm').addEventListener('input', toggleVendorDeleteButtons);

        function updateTotal() {
            let total = 0;
            const prices = document.getElementsByClassName('productPrice');
            const quantities = document.getElementsByClassName('productQuantity');
            for (let i = 0; i < prices.length; i++) {
                total += parseFloat(prices[i].value || 0) * parseInt(quantities[i].value || 0);
            }
            document.getElementById('totalAmount').innerText = total.toFixed(2);
        }

        function toggleDeleteButtons() {
            const productRows = document.getElementsByClassName('productRow');
            for (let i = 0; i < productRows.length; i++) {
                const deleteButton = productRows[i].querySelector('button');
                if (productRows[i].querySelector('.productName').value.trim() !== '') {
                    deleteButton.style.display = 'inline-block';
                } else {
                    deleteButton.style.display = 'none';
                }
            }
        }

        function toggleVendorDeleteButtons() {
            const vendorSections = document.getElementsByClassName('vendorSection');
            for (let i = 0; i < vendorSections.length; i++) {
                const vendorId = vendorSections[i].querySelector('.vendorId');
                const deleteVendorButton = vendorSections[i].querySelector('button[onclick="deleteVendorSection(this)"]');
                if (vendorId.value.trim() !== '') {
                    deleteVendorButton.style.display = 'inline-block';
                } else {
                    deleteVendorButton.style.display = 'none';
                }
            }
        }
    </script>

    <script>
        document.getElementById('fundraiserForm').addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent the form from submitting the normal way

            const customerId = document.getElementById('customerId').value;
            const vendors = [];

            // Loop through each vendor section and gather data
            const vendorSections = document.getElementsByClassName('vendorSection');
            for (let i = 0; i < vendorSections.length; i++) {
                const vendorId = vendorSections[i].querySelector('.vendorId').value;
                const products = [];

                const productRows = vendorSections[i].getElementsByClassName('productRow');
                for (let j = 0; j < productRows.length; j++) {
                    const productName = productRows[j].querySelector('.productName').value;
                    const productPrice = productRows[j].querySelector('.productPrice').value;
                    const productQuantity = productRows[j].querySelector('.productQuantity').value;

                    products.push({
                        productName,
                        productPrice,
                        productQuantity
                    });
                }

                vendors.push({
                    vendorId,
                    products
                });
            }

            // Prepare data to send
            const data = {
                customerId,
                vendors
            };

            // Send data to Google Apps Script
            fetch('https://script.google.com/macros/s/AKfycby9FfhV_jaIBMlneLUHeIvSP3RyFKknNK_K6Qtxhd2pOBUJXfGz0vK3KqqZ-7hrR5pG/exec', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.text())
                .then(result => {
                    alert('Form submitted successfully!');
                    console.log(result);
                })
                .catch(error => {
                    alert('There was an error submitting the form.');
                    console.error('Error:', error);
                });
        });
    </script>

</body>

</html>